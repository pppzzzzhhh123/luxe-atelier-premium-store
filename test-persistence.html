<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LUXE API æµ‹è¯•å·¥å…· - æ•°æ®æŒä¹…åŒ–éªŒè¯</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .card h2 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #1a1a1a;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ccc;
    }
    
    .status.success { background: #10b981; }
    .status.error { background: #ef4444; }
    .status.pending { background: #f59e0b; }
    
    .input-group {
      margin-bottom: 12px;
    }
    
    .input-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #666;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .input-group input,
    .input-group select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:active {
      transform: translateY(0);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .result {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .result.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    
    .result.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
    }
    
    .token-display {
      background: #f3f4f6;
      padding: 12px;
      border-radius: 8px;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      word-break: break-all;
      margin-bottom: 16px;
    }
    
    .checklist {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .checklist h2 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #1a1a1a;
    }
    
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 8px;
      background: #f9fafb;
    }
    
    .checklist-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .checklist-item label {
      flex: 1;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”§ LUXE API æµ‹è¯•å·¥å…·</h1>
      <p>æ•°æ®æŒä¹…åŒ–åŠŸèƒ½éªŒè¯ | åç«¯: https://luxe-pi-kohl.vercel.app</p>
    </div>

    <div class="grid">
      <!-- 1. ç”¨æˆ·ç™»å½• -->
      <div class="card">
        <h2><span class="status" id="status-login"></span> 1. ç”¨æˆ·ç™»å½•</h2>
        <div class="input-group">
          <label>æ‰‹æœºå·</label>
          <input type="text" id="login-phone" value="13800138000" placeholder="è¾“å…¥æ‰‹æœºå·">
        </div>
        <div class="input-group">
          <label>å¯†ç </label>
          <input type="password" id="login-password" value="123456" placeholder="è¾“å…¥å¯†ç ">
        </div>
        <button class="btn btn-primary" onclick="testLogin()">ç™»å½•</button>
        <div id="result-login"></div>
      </div>

      <!-- 2. è·å–ç”¨æˆ·ä¿¡æ¯ -->
      <div class="card">
        <h2><span class="status" id="status-profile"></span> 2. è·å–ç”¨æˆ·ä¿¡æ¯</h2>
        <div class="token-display" id="token-display">è¯·å…ˆç™»å½•</div>
        <button class="btn btn-primary" onclick="testGetProfile()" disabled id="btn-profile">è·å–ç”¨æˆ·ä¿¡æ¯</button>
        <div id="result-profile"></div>
      </div>

      <!-- 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯ -->
      <div class="card">
        <h2><span class="status" id="status-update"></span> 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯</h2>
        <div class="input-group">
          <label>æ˜µç§°</label>
          <input type="text" id="update-nickname" placeholder="è¾“å…¥æ–°æ˜µç§°">
        </div>
        <div class="input-group">
          <label>æ€§åˆ«</label>
          <select id="update-gender">
            <option value="">ä¸ä¿®æ”¹</option>
            <option value="ç”·">ç”·</option>
            <option value="å¥³">å¥³</option>
            <option value="ä¿å¯†">ä¿å¯†</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="testUpdateProfile()" disabled id="btn-update">æ›´æ–°ä¿¡æ¯</button>
        <div id="result-update"></div>
      </div>

      <!-- 4. è·å–åœ°å€åˆ—è¡¨ -->
      <div class="card">
        <h2><span class="status" id="status-addresses"></span> 4. è·å–åœ°å€åˆ—è¡¨</h2>
        <button class="btn btn-primary" onclick="testGetAddresses()" disabled id="btn-addresses">è·å–åœ°å€åˆ—è¡¨</button>
        <div id="result-addresses"></div>
      </div>

      <!-- 5. åˆ›å»ºåœ°å€ -->
      <div class="card">
        <h2><span class="status" id="status-create-address"></span> 5. åˆ›å»ºåœ°å€</h2>
        <div class="input-group">
          <label>æ”¶è´§äºº</label>
          <input type="text" id="address-name" value="å¼ ä¸‰" placeholder="æ”¶è´§äººå§“å">
        </div>
        <div class="input-group">
          <label>æ‰‹æœºå·</label>
          <input type="text" id="address-phone" value="13900139000" placeholder="æ‰‹æœºå·">
        </div>
        <div class="input-group">
          <label>è¯¦ç»†åœ°å€</label>
          <input type="text" id="address-detail" value="åŒ—äº¬å¸‚æœé˜³åŒºæŸæŸè¡—é“123å·" placeholder="è¯¦ç»†åœ°å€">
        </div>
        <button class="btn btn-primary" onclick="testCreateAddress()" disabled id="btn-create-address">åˆ›å»ºåœ°å€</button>
        <div id="result-create-address"></div>
      </div>

      <!-- 6. æµ‹è¯•è®¢å•åˆ›å»º -->
      <div class="card">
        <h2><span class="status" id="status-order"></span> 6. æµ‹è¯•è®¢å•åˆ›å»º</h2>
        <div class="input-group">
          <label>åœ°å€ ID</label>
          <input type="number" id="order-address-id" placeholder="ä»åœ°å€åˆ—è¡¨è·å–">
        </div>
        <div class="input-group">
          <label>è´­ç‰©è½¦å•†å“ ID</label>
          <input type="text" id="order-cart-ids" placeholder="ä¾‹å¦‚: 1,2,3">
        </div>
        <button class="btn btn-primary" onclick="testCreateOrder()" disabled id="btn-order">åˆ›å»ºè®¢å•</button>
        <div id="result-order"></div>
      </div>
    </div>

    <!-- æµ‹è¯•æ£€æŸ¥æ¸…å• -->
    <div class="checklist">
      <h2>âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•</h2>
      <div class="checklist-item">
        <input type="checkbox" id="check-1">
        <label for="check-1">1. ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œè·å¾— token</label>
      </div>
      <div class="checklist-item">
        <input type="checkbox" id="check-2">
        <label for="check-2">2. è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼Œæ˜¾ç¤ºæ˜µç§°ç­‰æ•°æ®</label>
      </div>
      <div class="checklist-item">
        <input type="checkbox" id="check-3">
        <label for="check-3">3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯æˆåŠŸï¼Œåˆ·æ–°é¡µé¢åæ•°æ®ä¿æŒ</label>
      </div>
      <div class="checklist-item">
        <input type="checkbox" id="check-4">
        <label for="check-4">4. è·å–åœ°å€åˆ—è¡¨æˆåŠŸ</label>
      </div>
      <div class="checklist-item">
        <input type="checkbox" id="check-5">
        <label for="check-5">5. åˆ›å»ºåœ°å€æˆåŠŸï¼Œåˆ·æ–°é¡µé¢ååœ°å€å­˜åœ¨</label>
      </div>
      <div class="checklist-item">
        <input type="checkbox" id="check-6">
        <label for="check-6">6. åˆ›å»ºè®¢å•æˆåŠŸï¼ˆä¸æ˜¯ 404ï¼‰</label>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://luxe-pi-kohl.vercel.app/api';
    let token = '';

    // æ˜¾ç¤ºç»“æœ
    function showResult(elementId, data, isError = false) {
      const element = document.getElementById(elementId);
      element.className = `result ${isError ? 'error' : 'success'}`;
      element.textContent = JSON.stringify(data, null, 2);
    }

    // æ›´æ–°çŠ¶æ€
    function updateStatus(statusId, status) {
      const element = document.getElementById(statusId);
      element.className = `status ${status}`;
    }

    // 1. ç™»å½•
    async function testLogin() {
      const phone = document.getElementById('login-phone').value;
      const password = document.getElementById('login-password').value;

      try {
        updateStatus('status-login', 'pending');
        const response = await fetch(`${API_BASE}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, password })
        });

        const data = await response.json();

        if (response.ok && data.token) {
          token = data.token;
          document.getElementById('token-display').textContent = `Token: ${token.substring(0, 50)}...`;
          
          // å¯ç”¨å…¶ä»–æŒ‰é’®
          ['btn-profile', 'btn-update', 'btn-addresses', 'btn-create-address', 'btn-order'].forEach(id => {
            document.getElementById(id).disabled = false;
          });

          updateStatus('status-login', 'success');
          showResult('result-login', data);
        } else {
          throw new Error(data.message || 'ç™»å½•å¤±è´¥');
        }
      } catch (error) {
        updateStatus('status-login', 'error');
        showResult('result-login', { error: error.message }, true);
      }
    }

    // 2. è·å–ç”¨æˆ·ä¿¡æ¯
    async function testGetProfile() {
      try {
        updateStatus('status-profile', 'pending');
        const response = await fetch(`${API_BASE}/users/me`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        const data = await response.json();

        if (response.ok) {
          updateStatus('status-profile', 'success');
          showResult('result-profile', data);
          
          // è‡ªåŠ¨å¡«å……æ˜µç§°
          if (data.data && data.data.nickname) {
            document.getElementById('update-nickname').value = data.data.nickname;
          }
        } else {
          throw new Error(data.message || 'è·å–å¤±è´¥');
        }
      } catch (error) {
        updateStatus('status-profile', 'error');
        showResult('result-profile', { error: error.message }, true);
      }
    }

    // 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    async function testUpdateProfile() {
      const nickname = document.getElementById('update-nickname').value;
      const gender = document.getElementById('update-gender').value;

      const updateData = {};
      if (nickname) updateData.nickname = nickname;
      if (gender) updateData.gender = gender;

      if (Object.keys(updateData).length === 0) {
        alert('è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªè¦æ›´æ–°çš„å­—æ®µ');
        return;
      }

      try {
        updateStatus('status-update', 'pending');
        const response = await fetch(`${API_BASE}/users/me`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(updateData)
        });

        const data = await response.json();

        if (response.ok) {
          updateStatus('status-update', 'success');
          showResult('result-update', data);
          alert('âœ… æ›´æ–°æˆåŠŸï¼è¯·åˆ·æ–°é¡µé¢éªŒè¯æ•°æ®æ˜¯å¦ä¿æŒ');
        } else {
          throw new Error(data.message || 'æ›´æ–°å¤±è´¥');
        }
      } catch (error) {
        updateStatus('status-update', 'error');
        showResult('result-update', { error: error.message }, true);
      }
    }

    // 4. è·å–åœ°å€åˆ—è¡¨
    async function testGetAddresses() {
      try {
        updateStatus('status-addresses', 'pending');
        const response = await fetch(`${API_BASE}/addresses`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });

        const data = await response.json();

        if (response.ok) {
          updateStatus('status-addresses', 'success');
          showResult('result-addresses', data);
          
          // è‡ªåŠ¨å¡«å……ç¬¬ä¸€ä¸ªåœ°å€ ID
          if (data.data && data.data.length > 0) {
            document.getElementById('order-address-id').value = data.data[0].id;
          }
        } else {
          throw new Error(data.message || 'è·å–å¤±è´¥');
        }
      } catch (error) {
        updateStatus('status-addresses', 'error');
        showResult('result-addresses', { error: error.message }, true);
      }
    }

    // 5. åˆ›å»ºåœ°å€
    async function testCreateAddress() {
      const name = document.getElementById('address-name').value;
      const phone = document.getElementById('address-phone').value;
      const detail = document.getElementById('address-detail').value;

      if (!name || !phone || !detail) {
        alert('è¯·å¡«å†™å®Œæ•´çš„åœ°å€ä¿¡æ¯');
        return;
      }

      try {
        updateStatus('status-create-address', 'pending');
        const response = await fetch(`${API_BASE}/addresses`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            name,
            phone,
            province: 'åŒ—äº¬å¸‚',
            city: 'æœé˜³åŒº',
            detail,
            tag: 'å®¶',
            isDefault: false
          })
        });

        const data = await response.json();

        if (response.ok) {
          updateStatus('status-create-address', 'success');
          showResult('result-create-address', data);
          alert('âœ… åœ°å€åˆ›å»ºæˆåŠŸï¼è¯·åˆ·æ–°é¡µé¢éªŒè¯åœ°å€æ˜¯å¦å­˜åœ¨');
          
          // è‡ªåŠ¨å¡«å……åœ°å€ ID
          if (data.data && data.data.id) {
            document.getElementById('order-address-id').value = data.data.id;
          }
        } else {
          throw new Error(data.message || 'åˆ›å»ºå¤±è´¥');
        }
      } catch (error) {
        updateStatus('status-create-address', 'error');
        showResult('result-create-address', { error: error.message }, true);
      }
    }

    // 6. åˆ›å»ºè®¢å•
    async function testCreateOrder() {
      const addressId = document.getElementById('order-address-id').value;
      const cartIds = document.getElementById('order-cart-ids').value;

      if (!addressId) {
        alert('è¯·å…ˆåˆ›å»ºåœ°å€æˆ–ä»åœ°å€åˆ—è¡¨è·å–åœ°å€ ID');
        return;
      }

      if (!cartIds) {
        alert('è¯·è¾“å…¥è´­ç‰©è½¦å•†å“ IDï¼ˆç”¨é€—å·åˆ†éš”ï¼‰');
        return;
      }

      const cartItemIds = cartIds.split(',').map(id => parseInt(id.trim()));

      try {
        updateStatus('status-order', 'pending');
        const response = await fetch(`${API_BASE}/orders`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            addressId: parseInt(addressId),
            cartItemIds,
            paymentMethod: 'alipay',
            remark: 'æµ‹è¯•è®¢å•'
          })
        });

        const data = await response.json();

        if (response.ok) {
          updateStatus('status-order', 'success');
          showResult('result-order', data);
          alert('âœ… è®¢å•åˆ›å»ºæˆåŠŸï¼');
        } else {
          // å³ä½¿å¤±è´¥ï¼Œåªè¦ä¸æ˜¯ 404 å°±ç®—éƒ¨åˆ†æˆåŠŸ
          if (response.status === 404) {
            updateStatus('status-order', 'error');
            showResult('result-order', { error: '404 - æ¥å£ä¸å­˜åœ¨ï¼Œåç«¯æœªéƒ¨ç½²ï¼' }, true);
          } else {
            updateStatus('status-order', 'pending');
            showResult('result-order', { 
              status: response.status,
              message: data.message || 'è¯·æ±‚å·²å‘é€ï¼Œä½†ä¸šåŠ¡é€»è¾‘å¤±è´¥',
              note: 'å¦‚æœä¸æ˜¯ 404ï¼Œè¯´æ˜æ¥å£å­˜åœ¨ï¼Œåªæ˜¯ä¸šåŠ¡é€»è¾‘é—®é¢˜'
            });
          }
        }
      } catch (error) {
        updateStatus('status-order', 'error');
        showResult('result-order', { error: error.message }, true);
      }
    }
  </script>
</body>
</html>
