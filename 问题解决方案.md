# ðŸŽ¯ æ³¨å†ŒåŠŸèƒ½é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ðŸ“‹ é—®é¢˜æè¿°

**ç—‡çŠ¶ï¼š**
- å‰ç«¯å¯ä»¥æ­£å¸¸æ‰“å¼€ http://localhost:5173/
- ç‚¹å‡»æ³¨å†ŒåŽï¼Œæ•°æ®åº“ä¸­æ²¡æœ‰æ·»åŠ ç”¨æˆ·ä¿¡æ¯
- æµè§ˆå™¨æŽ§åˆ¶å°æ— æ³•æ‰§è¡Œ `console.log(import.meta.env.VITE_API_URL)`

## ðŸ” æ ¹æœ¬åŽŸå› 

### æ ¸å¿ƒé—®é¢˜ï¼šå‰ç«¯å®Œå…¨æ²¡æœ‰è°ƒç”¨åŽç«¯ APIï¼

æ£€æŸ¥ `components/Auth.tsx` åŽå‘çŽ°ï¼š

```typescript
// âŒ é”™è¯¯çš„ä»£ç ï¼ˆä¿®å¤å‰ï¼‰
const handleRegister = async () => {
  // ...éªŒè¯é€»è¾‘...
  
  setLoading(true);

  // æ¨¡æ‹Ÿæ³¨å†Œè¯·æ±‚ - è¿™åªæ˜¯å»¶è¿Ÿï¼Œæ²¡æœ‰çœŸå®žè¯·æ±‚ï¼
  setTimeout(() => {
    const user: UserInfo = {
      id: `user_${Date.now()}`,  // å‡çš„ ID
      name: 'LUXEç”¨æˆ·',
      phone: phone,
      avatar: '...',
      token: `token_${Date.now()}`,  // å‡çš„ Token
    };

    // åªä¿å­˜åˆ° localStorageï¼Œä»Žæœªå‘é€åˆ°åŽç«¯
    localStorage.setItem('luxe-user', JSON.stringify(user));
    localStorage.setItem('luxe-token', user.token);

    setLoading(false);
    onSuccess(user);
  }, 1500);  // åªæ˜¯ç­‰å¾… 1.5 ç§’
};
```

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ•°æ®åº“ä¸­æ²¡æœ‰ç”¨æˆ·çš„åŽŸå› ï¼**

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤ `components/Auth.tsx`

#### æ­¥éª¤ 1: å¯¼å…¥ API æ¨¡å—

```typescript
import React, { useState } from 'react';
import { authAPI } from '../src/api';  // âœ… æ·»åŠ è¿™è¡Œ
```

#### æ­¥éª¤ 2: ä¿®å¤æ³¨å†Œå‡½æ•°

```typescript
// âœ… æ­£ç¡®çš„ä»£ç ï¼ˆä¿®å¤åŽï¼‰
const handleRegister = async () => {
  setError('');
  
  // ...éªŒè¯é€»è¾‘...

  setLoading(true);

  try {
    // âœ… è°ƒç”¨çœŸå®žçš„åŽç«¯ API
    const response: any = await authAPI.register({
      phone,
      code,
      password,
      inviteCode: inviteCode || undefined
    });

    console.log('âœ… æ³¨å†ŒæˆåŠŸ:', response);

    // âœ… ä½¿ç”¨åŽç«¯è¿”å›žçš„çœŸå®žæ•°æ®
    const user: UserInfo = {
      id: response.user.id,           // çœŸå®žçš„æ•°æ®åº“ ID
      name: response.user.name,       // çœŸå®žçš„ç”¨æˆ·å
      phone: response.user.phone,     // çœŸå®žçš„æ‰‹æœºå·
      avatar: response.user.avatar || '...',
      token: response.token,          // çœŸå®žçš„ JWT Token
    };

    // ä¿å­˜åˆ° localStorage
    localStorage.setItem('luxe-user', JSON.stringify(user));
    localStorage.setItem('luxe-token', user.token);

    setLoading(false);
    onSuccess(user);
  } catch (err: any) {
    console.error('âŒ æ³¨å†Œå¤±è´¥:', err);
    setLoading(false);
    setError(err || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¿¡æ¯æ˜¯å¦æ­£ç¡®');
  }
};
```

#### æ­¥éª¤ 3: ä¿®å¤ç™»å½•å‡½æ•°

åŒæ ·çš„ä¿®å¤é€»è¾‘ï¼Œä»Žæ¨¡æ‹Ÿæ”¹ä¸ºçœŸå®ž API è°ƒç”¨ã€‚

#### æ­¥éª¤ 4: ä¿®å¤å‘é€éªŒè¯ç å‡½æ•°

```typescript
const handleSendCode = async () => {
  if (!phone || !/^1[3-9]\d{9}$/.test(phone)) {
    setError('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
    return;
  }

  try {
    setError('');
    
    // âœ… è°ƒç”¨çœŸå®žçš„åŽç«¯ API
    await authAPI.sendCode(phone);
    
    // å¼€å§‹å€’è®¡æ—¶
    setCountdown(60);
    const timer = setInterval(() => {
      setCountdown(prev => {
        if (prev <= 1) {
          clearInterval(timer);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    console.log('âœ… éªŒè¯ç å·²å‘é€åˆ°:', phone);
    alert('éªŒè¯ç å·²å‘é€ï¼Œè¯·æŸ¥æ”¶çŸ­ä¿¡ï¼ˆå¼€å‘çŽ¯å¢ƒé»˜è®¤ï¼š123456ï¼‰');
  } catch (err: any) {
    console.error('âŒ å‘é€éªŒè¯ç å¤±è´¥:', err);
    setError(err || 'å‘é€éªŒè¯ç å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•');
  }
};
```

### 2. å…³äºŽæµè§ˆå™¨æŽ§åˆ¶å°è­¦å‘Š

**è­¦å‘Šä¿¡æ¯ï¼š**
```
Warning: Don't paste code into the DevTools Console that you don't understand 
or haven't reviewed yourself. This could allow attackers to steal your identity 
or take control of your computer. Please type 'allow pasting' below and hit 
Enter to allow pasting.
```

**è¿™æ˜¯æµè§ˆå™¨çš„å®‰å…¨æœºåˆ¶ï¼Œä¸æ˜¯é”™è¯¯ï¼**

**è§£å†³æ–¹æ³•ï¼š**

**æ–¹æ³• 1ï¼šè¾“å…¥å…è®¸ç²˜è´´**
1. åœ¨æŽ§åˆ¶å°ä¸­è¾“å…¥ï¼š`allow pasting`
2. æŒ‰å›žè½¦
3. ç„¶åŽå°±å¯ä»¥ç²˜è´´ä»£ç äº†

**æ–¹æ³• 2ï¼šç›´æŽ¥æ‰‹åŠ¨è¾“å…¥ï¼ˆæŽ¨èï¼‰**
```javascript
// ä¸è¦ç²˜è´´ï¼Œç›´æŽ¥åœ¨æŽ§åˆ¶å°è¾“å…¥ï¼š
import.meta.env.VITE_API_URL
```

**æ–¹æ³• 3ï¼šåœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—**

åœ¨ `src/api/index.ts` é¡¶éƒ¨æ·»åŠ ï¼š
```typescript
console.log('ðŸ”— API Base URL:', import.meta.env.VITE_API_URL);
```

è¿™æ ·åˆ·æ–°é¡µé¢å°±èƒ½çœ‹åˆ° API URL äº†ã€‚

## ðŸ§ª æµ‹è¯•æ­¥éª¤

### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•å·¥å…·ï¼ˆæŽ¨èï¼‰

æˆ‘å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•å·¥å…·ï¼š

1. **æ‰“å¼€æµ‹è¯•å·¥å…·**
   ```
   ç›´æŽ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
   c:/Users/pizhe/Downloads/luxe-atelier-premium-store/test-api.html
   ```

2. **æµ‹è¯•è¿žæŽ¥**
   - ç‚¹å‡» "æµ‹è¯•è¿žæŽ¥" æŒ‰é’®
   - åº”è¯¥çœ‹åˆ° âœ… è¿žæŽ¥æˆåŠŸ

3. **æµ‹è¯•æ³¨å†Œ**
   - å¡«å†™æ‰‹æœºå·ï¼š`13900139001`
   - ç‚¹å‡» "å‘é€éªŒè¯ç "
   - å¡«å†™éªŒè¯ç ï¼š`123456`
   - å¡«å†™å¯†ç ï¼š`Test123456`
   - ç‚¹å‡» "æµ‹è¯•æ³¨å†Œ"
   - åº”è¯¥çœ‹åˆ° âœ… æ³¨å†ŒæˆåŠŸ

4. **æµ‹è¯•ç™»å½•**
   - ä½¿ç”¨åˆšæ‰æ³¨å†Œçš„è´¦å·ç™»å½•
   - åº”è¯¥çœ‹åˆ° âœ… ç™»å½•æˆåŠŸ

### æ–¹æ³• 2: ä½¿ç”¨å‰ç«¯åº”ç”¨

1. **å¯åŠ¨å‰ç«¯**
   ```bash
   cd c:/Users/pizhe/Downloads/luxe-atelier-premium-store
   npm run dev
   ```

2. **æ‰“å¼€æµè§ˆå™¨**
   - è®¿é—®ï¼šhttp://localhost:5173/
   - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·

3. **æµ‹è¯•æ³¨å†Œ**
   - ç‚¹å‡»å³ä¸Šè§’ "ç™»å½•/æ³¨å†Œ"
   - åˆ‡æ¢åˆ° "æ³¨å†Œ" æ ‡ç­¾
   - å¡«å†™ä¿¡æ¯å¹¶æäº¤

4. **æŸ¥çœ‹æŽ§åˆ¶å°**
   - åº”è¯¥çœ‹åˆ°ï¼š`âœ… æ³¨å†ŒæˆåŠŸ: {...}`
   - å¦‚æžœå¤±è´¥ï¼Œä¼šæ˜¾ç¤ºï¼š`âŒ æ³¨å†Œå¤±è´¥: ...`

5. **æŸ¥çœ‹ç½‘ç»œè¯·æ±‚**
   - åˆ‡æ¢åˆ° Network æ ‡ç­¾
   - åº”è¯¥çœ‹åˆ°ï¼š
     - `POST /api/auth/send-code` - çŠ¶æ€ 200
     - `POST /api/auth/register` - çŠ¶æ€ 201

6. **éªŒè¯æ•°æ®åº“**
   - æ‰“å¼€ Supabase æŽ§åˆ¶å°
   - è¿›å…¥ SQL Editor
   - æ‰§è¡Œï¼š
     ```sql
     SELECT * FROM users WHERE phone = '13900139001';
     ```
   - åº”è¯¥çœ‹åˆ°æ–°æ³¨å†Œçš„ç”¨æˆ·

## ðŸ“Š å®Œæ•´çš„è¯·æ±‚æµç¨‹

```
ç”¨æˆ·å¡«å†™æ³¨å†Œä¿¡æ¯
    â†“
ç‚¹å‡»"æ³¨å†Œ"æŒ‰é’®
    â†“
å‰ç«¯éªŒè¯è¾“å…¥ï¼ˆæ‰‹æœºå·ã€éªŒè¯ç ã€å¯†ç ï¼‰
    â†“
è°ƒç”¨ authAPI.register({ phone, code, password })
    â†“
å‘é€ POST è¯·æ±‚åˆ°ï¼š
https://luxe-pi-kohl.vercel.app/api/auth/register
    â†“
åŽç«¯æŽ¥æ”¶è¯·æ±‚ï¼ˆbackend/src/routes/auth.tsï¼‰
    â†“
éªŒè¯å¿…å¡«å­—æ®µ
    â†“
æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²æ³¨å†Œ
    â†“
ä½¿ç”¨ bcrypt åŠ å¯†å¯†ç 
    â†“
ç”Ÿæˆå”¯ä¸€é‚€è¯·ç 
    â†“
å†™å…¥ Supabase users è¡¨
    â†“
ç”Ÿæˆ JWT Token
    â†“
è¿”å›žå“åº”ï¼š{ message, token, user }
    â†“
å‰ç«¯æŽ¥æ”¶å“åº”
    â†“
ä¿å­˜åˆ° localStorage
    â†“
æ›´æ–° UIï¼Œæ˜¾ç¤ºç™»å½•çŠ¶æ€
    â†“
âœ… æ³¨å†Œå®Œæˆï¼
```

## ðŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼ˆCORS é”™è¯¯ï¼‰

**é”™è¯¯ï¼š**
```
Access to XMLHttpRequest has been blocked by CORS policy
```

**åŽŸå› ï¼š** åŽç«¯ CORS é…ç½®é—®é¢˜

**è§£å†³ï¼š** åŽç«¯å·²é…ç½® CORSï¼ŒåŒ…å« `http://localhost:5173`

### é—®é¢˜ 2: æ‰‹æœºå·å·²æ³¨å†Œ

**é”™è¯¯ï¼š**
```
âŒ æ³¨å†Œå¤±è´¥: è¯¥æ‰‹æœºå·å·²æ³¨å†Œ
```

**è§£å†³ï¼š** ä½¿ç”¨ä¸åŒçš„æ‰‹æœºå·ï¼Œå¦‚ï¼š
- `13900139001`
- `13900139002`
- `13900139003`

### é—®é¢˜ 3: è¯·æ±‚è¶…æ—¶

**é”™è¯¯ï¼š**
```
âŒ æ³¨å†Œå¤±è´¥: timeout of 10000ms exceeded
```

**åŽŸå› ï¼š** Vercel å†·å¯åŠ¨

**è§£å†³ï¼š** ç­‰å¾… 10-15 ç§’åŽé‡è¯•

### é—®é¢˜ 4: æ•°æ®åº“è¿žæŽ¥å¤±è´¥

**é”™è¯¯ï¼š**
```
âŒ æ³¨å†Œå¤±è´¥: æœåŠ¡å™¨é”™è¯¯
```

**æ£€æŸ¥ï¼š**
1. Supabase é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. åŽç«¯çŽ¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
3. æ•°æ®åº“è¡¨ç»“æž„æ˜¯å¦æ­£ç¡®

## ðŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

- âœ… `components/Auth.tsx` - æ·»åŠ çœŸå®ž API è°ƒç”¨
- âœ… `test-api.html` - åˆ›å»ºç‹¬ç«‹æµ‹è¯•å·¥å…·
- âœ… `REGISTRATION_FIX_COMPLETE.md` - è¯¦ç»†ä¿®å¤æ–‡æ¡£
- âœ… `é—®é¢˜è§£å†³æ–¹æ¡ˆ.md` - æœ¬æ–‡æ¡£

## ðŸŽ¯ éªŒè¯æ¸…å•

å®Œæˆä¿®å¤åŽï¼Œè¯·éªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è®¿é—® http://localhost:5173/
- [ ] ç‚¹å‡»"èŽ·å–éªŒè¯ç "åŽï¼ŒæŽ§åˆ¶å°æ˜¾ç¤º `âœ… éªŒè¯ç å·²å‘é€`
- [ ] Network æ ‡ç­¾æ˜¾ç¤º `POST /api/auth/send-code` è¯·æ±‚æˆåŠŸ
- [ ] ç‚¹å‡»"æ³¨å†Œ"åŽï¼ŒæŽ§åˆ¶å°æ˜¾ç¤º `âœ… æ³¨å†ŒæˆåŠŸ`
- [ ] Network æ ‡ç­¾æ˜¾ç¤º `POST /api/auth/register` è¯·æ±‚æˆåŠŸ
- [ ] Supabase æ•°æ®åº“ä¸­å¯ä»¥çœ‹åˆ°æ–°ç”¨æˆ·è®°å½•
- [ ] å¯ä»¥ä½¿ç”¨æ³¨å†Œçš„è´¦å·ç™»å½•
- [ ] ç™»å½•åŽé¡µé¢å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

## ðŸš€ ç«‹å³æµ‹è¯•

### å¿«é€Ÿæµ‹è¯•ï¼ˆä½¿ç”¨æµ‹è¯•å·¥å…·ï¼‰

```bash
# 1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•å·¥å…·
start c:/Users/pizhe/Downloads/luxe-atelier-premium-store/test-api.html

# 2. ç‚¹å‡»"æµ‹è¯•è¿žæŽ¥"
# 3. ç‚¹å‡»"å‘é€éªŒè¯ç "
# 4. ç‚¹å‡»"æµ‹è¯•æ³¨å†Œ"
# 5. æŸ¥çœ‹ç»“æžœ
```

### å®Œæ•´æµ‹è¯•ï¼ˆä½¿ç”¨å‰ç«¯åº”ç”¨ï¼‰

```bash
# 1. å¯åŠ¨å‰ç«¯
cd c:/Users/pizhe/Downloads/luxe-atelier-premium-store
npm run dev

# 2. æ‰“å¼€æµè§ˆå™¨
# è®¿é—® http://localhost:5173/

# 3. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰

# 4. æµ‹è¯•æ³¨å†Œæµç¨‹

# 5. æ£€æŸ¥ Supabase æ•°æ®åº“
```

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. **æµè§ˆå™¨æŽ§åˆ¶å°çš„å®Œæ•´é”™è¯¯ä¿¡æ¯**
   - æˆªå›¾æˆ–å¤åˆ¶æ–‡æœ¬

2. **Network æ ‡ç­¾ä¸­çš„è¯·æ±‚è¯¦æƒ…**
   - Request URL
   - Request Method
   - Status Code
   - Request Payload
   - Response

3. **ä½¿ç”¨çš„æµ‹è¯•æ•°æ®**
   - æ‰‹æœºå·
   - å¯†ç 
   - é‚€è¯·ç ï¼ˆå¦‚æžœæœ‰ï¼‰

4. **åŽç«¯å¥åº·æ£€æŸ¥ç»“æžœ**
   - è®¿é—®ï¼šhttps://luxe-pi-kohl.vercel.app/health
   - æä¾›è¿”å›žçš„ JSON

---

**ä¿®å¤å®Œæˆæ—¶é—´ï¼š** 2025-01-17  
**ä¿®å¤å†…å®¹ï¼š** å‰ç«¯æ³¨å†Œ/ç™»å½•ä»Žæ¨¡æ‹Ÿæ”¹ä¸ºçœŸå®ž API è°ƒç”¨  
**å½±å“æ–‡ä»¶ï¼š** `components/Auth.tsx`  
**æµ‹è¯•å·¥å…·ï¼š** `test-api.html`
